"use strict";var Toucher;!function(f){function t(t){for(var e in this.initialize(),t)this[e]=t[e]}var p={EVENT_LIST:["touches","changedTouches","targetTouches"],touches:"touches",changedTouches:"changedTouches",targetTouches:"targetTouches",defaultTouchId:1},e={constructor:t,initialize:function(){this.host=window,this.dom=document,this.pixelRatio=1,this.offsetLeft=0,this.offsetTop=0,this.canvasWidth=0,this.canvasHeight=0,this.orientation=0,this.offsetX=0,this.offsetY=0,this.supportMultiTouch=!1,this.useMouse=null,this.useTouch=null,this.useCapture=!0,this.usePassive=!1,this.useOnce=!1,this.preventDefault=!1,this.ignoreNativeGesture=!0,this.preventDefaultStart=!1,this.preventDefaultMove=!1,this.preventDefaultEnd=!1,this.preventDefaultCancel=!1,this.touchKeepTime=30,this.maxTouch=5,this.startTouches=null,this.moveTouches=null,this.endTouches=null,this.moveTick=0,this.moveInterval=0,this.touchCount=0,this.touchedCount=0},beforeInit:function(){},init:function(){this.listenerList=[];var t=!(this.EVENT={});try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("__test__",null,e)}catch(t){}if(this.passiveSupported=t,this.reset(),this.beforeInit(),this.supportMultiTouch="ontouchstart"in this.dom,this.supportMultiTouch&&!1!==this.useTouch?this.useTouch=!0:this.useTouch=!1,this.supportMultiTouch||!1===this.useMouse?this.useMouse=!1:this.useMouse=!0,!1!==this.useTouch||!1!==this.useMouse){!0===this.useMouse?(this.EVENT.START="mousedown",this.EVENT.MOVE="mousemove",this.EVENT.END="mouseup",this.EVENT.CANCEL=null):(this.EVENT.START="touchstart",this.EVENT.MOVE="touchmove",this.EVENT.END="touchend",this.EVENT.CANCEL="touchcancel");var i=this.dom;this.pageWidth=i.clientWidth,this.pageHeight=i.clientHeight;var s=this;e=this.passiveSupported?{capture:this.useCapture,passive:this.usePassive,once:this.useOnce}:this.useCapture,this._startHook=function(t){s.touchCount++;var e=Date.now();!0===s.useMouse&&s.reset(),null!==s.beforeStart&&!1===s.beforeStart(t,e)||(s.onStart(t,e),(s.preventDefaultStart||s.preventDefault)&&s.preventEventDefault(t))},i.addEventListener(this.EVENT.START,this._startHook,e),this._moveHook=function(t){var e=Date.now();e-s.moveTick<s.moveInterval||null!==s.beforeMove&&!1===s.beforeMove(t,e)||(s.moveTick=e,s.onMove(t,e),(s.preventDefaultMove||s.preventDefault)&&s.preventEventDefault(t))},i.addEventListener(this.EVENT.MOVE,this._moveHook,e),this._endHook=function(t){s.touchCount--;var e=Date.now();null!==s.beforeEnd&&!1===s.beforeEnd(t,e)||(s.onEnd(t,e),(s.preventDefaultEnd||s.preventDefault)&&s.preventEventDefault(t))},i.addEventListener(this.EVENT.END,this._endHook,e),!0===this.useMouse?(this._outHook=function(t){s.touchCount--;var e=t.relatedTarget||t.toElement;e&&"HTML"!==e.nodeName||s._endHook(t),s.preventEventDefault(t)},window.addEventListener("mouseout",this._outHook,e)):(this._cancelHook=function(t){console.log("===== "+s.EVENT.CANCEL+" ====="),s.touchCount--;var e=Date.now();null!==s.beforeCancel&&!1===s.beforeCancel(t)||(s.onCancel(t,e),(s.preventDefaultCancel||s.preventDefault)&&s.preventEventDefault(t))},i.addEventListener(this.EVENT.CANCEL,this._cancelHook,e)),!1===this.useMouse&&this.ignoreNativeGesture&&"ongesturestart"in window&&(this._gestureHook=function(t){s.preventEventDefault(t)},window.addEventListener("gesturestart",this._gestureHook,!0),window.addEventListener("gesturechange",this._gestureHook,!0),window.addEventListener("gestureend",this._gestureHook,!0)),this.updateDomOffset(),this.onInit()}},onInit:function(){},addEventListener:function(t,e,i,s){this.passiveSupported||(s=s.useCapture),t.addEventListener(e,i,s)},removeEventListener:function(t,e,i,s){this.passiveSupported||(s=s.useCapture),t.removeEventListener(e,i,s)},preventEventDefault:function(t){return!(!t.cancelable&&"cancelable"in t)&&(t.preventDefault(),!0)},reset:function(){this.startTouches=[],this.moveTouches=[],this.endTouches=[],this.startTouches.lastTime=this.moveTouches.lastTime=this.endTouches.lastTime=0,this.touched={};for(var t=this.touchedCount=0,e=this.listenerList.length;t<e;t++){this.listenerList[t].reset()}},updateDomOffset:function(t){var e=0,i=0;if((t=this.dom)===window||t===document)e=window.pageXOffset||0,i=window.pageYOffset||0;else if(void 0!==t.getBoundingClientRect){var s=window.pageXOffset,n=0;n=s||0===s?window.pageYOffset:(s=document.body.scrollLeft||0,document.body.scrollTop||0);var o=t.getBoundingClientRect();e=o.left+s,i=o.top+n}else{for(var h=t.offsetLeft||0,r=t.offsetTop||0;(t=t.parentNode)&&t!==document.body&&t!==document;)h+=t.offsetLeft||0,r+=t.offsetTop||0;e=h,i=r}this.offsetLeft=e,this.offsetTop=i},beforeStart:null,onStart:function(t,e){var i=this.getStartWrappers(t,e);this.dispatch("start",i,t)},beforeMove:null,onMove:function(t,e){var i=this.getMoveWrappers(t,e);this.dispatch("move",i,t)},beforeEnd:null,onEnd:function(t,e){var i=this.getEndWrappers(t,e);this.dispatch("end",i,t)},beforeCancel:null,onCancel:function(t,e){for(var i=0,s=this.listenerList.length;i<s;i++){var n=this.listenerList[i];if(n.cancel&&!1===n.cancel(null,t,this))break}},addTouches:function(t,e){t.length>=this.maxTouch&&t.shift(),t.push(e)},removeFromTouches:function(t,e){t.length>=this.maxTouch&&t.shift(),t.push(e)},getStartWrappers:function(t,e){for(var i=f.TouchWrapper,s=t[p.changedTouches]||[t],n=[],o=0,h=s.length;o<h;o++){var r=s[o],a=r.identifier,u=a||0===a?a:p.defaultTouchId,c=this.touched[u];(c=i.getInstance(u)).pixelRatio=this.pixelRatio,c.orientation=this.orientation,c.pageWidth=this.pageWidth,c.pageHeight=this.pageHeight,c.offsetX=this.offsetX,c.offsetY=this.offsetY,c.offsetLeft=this.offsetLeft,c.offsetTop=this.offsetTop,c.EVENT=this.EVENT,this.touched[u]=c,this.touchedCount++,c.start(r,t),n.push(c);var l=this.startTouches;e-l.lastTime>this.touchKeepTime&&(l.length=0),l.lastTime=e,l.push(c)}return n},getMoveWrappers:function(t,e){for(var i=t[p.changedTouches]||[t],s=[],n=0,o=i.length;n<o;n++){var h=i[n],r=h.identifier,a=r||0===r?r:p.defaultTouchId,u=this.touched[a];if(u){if(!u.moveTime){var c=this.moveTouches;e-c.lastTime>this.touchKeepTime&&(c.length=0),c.lastTime=e,c.push(u)}u.move(h,t),s.push(u)}}return s},getEndWrappers:function(t,e){for(var i=t[p.changedTouches]||[t],s=[],n=0,o=i.length;n<o;n++){var h=i[n],r=h.identifier,a=r||0===r?r:p.defaultTouchId,u=this.touched[a];if(u){u.end(h,t),delete this.touched[a],this.touchedCount--,s.push(u);var c=this.endTouches;e-c.lastTime>this.touchKeepTime&&(c.length=0),c.lastTime=e,c.push(u),this.removeWrapper(this.startTouches,a),this.removeWrapper(this.moveTouches,a)}}return s},removeWrapper:function(t,e){for(var i=t.length-1;0<=i;i--)if(t[i].identifier===e)return t.splice(i,1),e;return!1},dispatch:function(t,e,i){for(var s=0,n=this.listenerList.length;s<n;s++){var o=this.listenerList[s];if(o[t]){var h=o.filterWrappers(t,e,i,this);if(!0===h&&(h=e),h&&0<h.length&&!1===o[t](h,i,this))break}}},addListener:function(t){t.controller=this,t.init(),this.listenerList.push(t),t.order=t.order||0},removeListener:function(t){for(var e=this.listenerList.length-1;0<=e;e--)if(this.listenerList[e]===t)return this.listenerList.splice(e,1),t.controller=null,t;return null},removeAllListeners:function(){for(var t=this.listenerList.length-1;0<=t;t--){this.listenerList[t].controller=null}this.listenerList.length=0},destroy:function(){this.reset(),this.removeAllListeners();var t=this.dom;t.removeEventListener(this.EVENT.START,this._startHook,this.useCapture),t.removeEventListener(this.EVENT.MOVE,this._moveHook,this.useCapture),t.removeEventListener(this.EVENT.END,this._endHook,this.useCapture),t.removeEventListener(this.EVENT.CANCEL,this._cancelHook,this.useCapture),window.removeEventListener("mouseout",this._outHook,!1),window.removeEventListener("gesturestart",this._gestureHook,!1),window.removeEventListener("gesturechange",this._gestureHook,!1),window.removeEventListener("gestureend",this._gestureHook,!1)}};for(var i in e)t.prototype[i]=e[i];f.Controller=t,f.CONST=p}(Toucher=Toucher||{}),function(t){function i(t){this.init(t)}t.CONST;i.pool=[],i.poolCursor=0,i.initPool=function(t){for(var e=i.pool.length=0;e<t;e++)i.pool[e]=new i(0)},i.getInstance=function(t){var e=i.pool[i.poolCursor];return++i.poolCursor>=i.pool.length&&(i.poolCursor=0),e.init(t),e};var e={constructor:i,init:function(t){t=t||0,this.pixelRatio=1,this.offsetLeft=0,this.offsetTop=0,this.orientation=0,this.offsetX=0,this.offsetY=0,this.identifier=t,this.id=t,this.updateTime=-1,this.startTime=-1,this.moveTime=-1,this.endTime=-1},start:function(t,e){this.type=this.EVENT.START,this.update(t,e),this.startPageX=this.lastPageX=this.pageX,this.startPageY=this.lastPageY=this.pageY,this.startTarget=this.lastTarget=this.target,this.deltaX=0,this.deltaY=0,this.moveAmountX=0,this.moveAmountY=0,this.touching=!0,this.startTime=this.moveTime=this.endTime=this.updateTime},move:function(t,e){this.type=this.EVENT.MOVE,this.lastMoveTime=this.moveTime,this.update(t,e),this.moveTime=this.updateTime},end:function(t,e){this.type=this.EVENT.END;var i=this.deltaX,s=this.deltaY;this.update(t,e),this.deltaX=i,this.deltaY=s,this.endPageX=this.pageX,this.endPageY=this.pageY,this.endTarget=this.target,this.touching=!1,this.endTime=this.updateTime},update:function(t,e){this.rawEvent=e,this.rawTouch=t,this.lastTarget=this.target,this.lastPageX=this.pageX,this.lastPageY=this.pageY,this.target=t.target||e.target;var i,s,n=t.pageX,o=t.pageY;s=0===this.orientation?(i=n-this.offsetLeft,o-this.offsetTop):-90===this.orientation?(i=this.pageHeight-o,n-this.offsetLeft):90===this.orientation?(i=o-this.offsetTop,this.pageWidth-n):180===this.orientation?(i=this.pageWidth-n,this.pageHeight-o):(i=n-this.offsetLeft,o-this.offsetTop),this.pageX=i*this.pixelRatio,this.pageY=s*this.pixelRatio,this.pageX-=this.offsetX,this.pageY-=this.offsetY,this.deltaX=this.pageX-this.lastPageX,this.deltaY=this.pageY-this.lastPageY,this.moveAmountX=this.pageX-this.startPageX,this.moveAmountY=this.pageY-this.startPageY,this.updateTime=Date.now()},getData:function(){var t={};return t.touching=this.touching,t.type=this.type,t.updateTime=this.updateTime,t.startTime=this.startTime,t.moveTime=this.moveTime,t.endTime=this.endTime,t.startPageX=this.startPageX,t.startPageY=this.startPageY,t.pageX=this.pageX,t.pageY=this.pageY,t.endPageX=this.endPageX,t.endPageY=this.endPageY,t.deltaX=this.deltaX,t.deltaY=this.deltaY,t.moveAmountX=this.moveAmountX,t.moveAmountY=this.moveAmountY,t}};for(var s in e)i.prototype[s]=e[s];i.initPool(20),t.TouchWrapper=i}(Toucher=Toucher||{}),function(t){function e(t){for(var e in t)this[e]=t[e]}t.CONST;e.extend=function(t){function e(t){for(var e in t)this[e]=t[e]}var i=e.prototype,s=this.prototype;for(var n in s)i[n]=s[n];for(var n in t)i[n]=t[n];return(i.constructor=e).extend=this.extend,e.$super=s,e.superclass=this,e};var i={constructor:e,id:null,type:null,order:1,multi:1,beforeInit:function(){},init:function(){this.beforeInit(),this.onInit()},onInit:function(){},reset:function(){},filterWrappers:function(t,e,i,s){for(var n=[],o=0,h=e.length;o<h;o++){var r=e[o];this.filterWrapper(t,r,i,s)&&n.push(r)}return n},filterWrapper:function(t,e,i,s){return!1},start:null,onTouchStart:null,move:null,onTouchMove:null,end:null,onTouchEnd:null,cancel:null,onTouchCancel:null};for(var s in i)e.prototype[s]=i[s];t.Listener=e}(Toucher=Toucher||{}),Toucher.Any=Toucher.Listener.extend({filterWrapper:function(t,e,i,s){return!0},start:function(t,e,i){},move:function(t,e,i){},end:function(t,e,i){},cancel:function(t,e,i){}}),Toucher.Tap=Toucher.Listener.extend({maxTimeLag:800,maxDistance:15,filterWrapper:function(t,e,i,s){return!0},onTap:function(t,e,i,s,n){},onTouchStart:null,onTouchEnd:null,checkMoveDistance:function(t){var e=Math.abs(t.moveAmountX),i=Math.abs(t.moveAmountY);return e<=this.maxDistance&&i<=this.maxDistance},checkTimeLag:function(t){return t.endTime-t.startTime<this.maxTimeLag},start:function(t,e,i){if(this.onTouchStart)for(var s=Math.min(t.length,this.multi),n=0;n<s;n++){var o=t[n],h=o.pageX,r=o.pageY;this.onTouchStart(h,r,o,e,i)}},end:function(t,e,i){for(var s=0,n=Math.min(t.length,this.multi),o=0;o<n;o++){var h=t[o],r=h.endPageX,a=h.endPageY;this.checkMoveDistance(h)&&this.checkTimeLag(h)&&(h.index=s++,this.onTap(r,a,h,e,i)),this.onTouchEnd&&this.onTouchEnd(r,a,h,e,i)}}}),Toucher.Pan=Toucher.Listener.extend({valid:!1,filterWrapper:function(t,e,i,s){return!0},onPan:function(t,e,i,s,n,o,h){},move:function(t,e,i){for(var s=0,n=Math.min(t.length,this.multi),o=0;o<n;o++){var h=t[o],r=h.deltaX,a=h.deltaY,u=h.pageX,c=h.pageY;h.index=s++,this.onPan(r,a,u,c,h,e,i)}}}),Toucher.Swipe=Toucher.Listener.extend({minDistance:50,maxTime:1e3,filterWrapper:function(t,e,i,s){return!0},onSwipe:function(t,e,i,s,n){},onTouchEnd:null,end:function(t,e,i){for(var s=0,n=Math.min(t.length,this.multi),o=0;o<n;o++){var h=t[o],r=h.endPageX,a=h.endPageY,u=h.endTime-h.startTime;if(u<=this.maxTime){var c=r-h.startPageX,l=a-h.startPageY;if(Math.abs(c)>=this.minDistance||Math.abs(l)>=this.minDistance){var f=c/u,p=l/u;h.index=s++,this.onSwipe(f,p,h,e,i)}}this.onTouchEnd&&this.onTouchEnd(r,a,h,e,i)}}}),Toucher.Pinch=Toucher.Listener.extend({touchA:null,touchB:null,startDistance:null,filterWrapper:function(t,e,i,s){return!0},onPinch:function(t,e,i,s,n,o,h){},onPinchEnd:null,start:function(t,e,i){for(var s=0;s<t.length;s++){var n=t[s];if(this.touchA){if(this.touchB)break;this.touchB=n}else this.touchA=n}if(this.touchA&&this.touchB){var o=this.touchB.startPageX-this.touchA.startPageX,h=this.touchB.startPageY-this.touchA.startPageY;this.startDistance=Math.sqrt(o*o+h*h),this.centerX=this.touchA.startPageX+this.touchB.startPageX>>1,this.centerY=this.touchA.startPageY+this.touchB.startPageY>>1}},move:function(t,e,i){var s=this.touchA,n=this.touchB;if(s&&n){var o=n.lastPageX-s.lastPageX,h=n.lastPageY-s.lastPageY,r=Math.sqrt(o*o+h*h),a=(o=n.pageX-s.pageX,h=n.pageY-s.pageY,Math.sqrt(o*o+h*h));this.onPinch(a,r,this.startDistance,[this.centerX,this.centerY],[s,n],e,i)}},end:function(t,e,i){for(var s=0;s<t.length;s++){var n=t[s];if(this.touchA&&this.touchA.id===n.id)this.touchA=null;else{if(!this.touchB||this.touchB.id!==n.id)break;this.touchB=null}}this.touchA&&this.touchB||(this.startDistance=null,this.onPinchEnd&&this.onPinchEnd(t,e,i))},cancel:function(t,e,i){this.touchA=null,this.touchB=null,this.startDistance=null}}),Toucher.Rotate=Toucher.Listener.extend({touchA:null,touchB:null,startDistance:-1,filterWrapper:function(t,e,i,s){return!0},onRotate:function(t,e,i,s,n){},start:function(t,e,i){for(var s=0;s<t.length;s++){var n=t[s];if(this.touchA){if(this.touchB)break;this.touchB=n}else this.touchA=n}if(this.touchA&&this.touchB){var o=this.touchB.startPageX-this.touchA.startPageX,h=this.touchB.startPageY-this.touchA.startPageY;this.startAngle=Math.atan2(h,o)}},move:function(t,e,i){var s=this.touchA,n=this.touchB;if(s&&n){var o=n.pageX-s.pageX,h=n.pageY-s.pageY,r=Math.atan2(h,o);this.onRotate(r,this.startAngle,[s,n],e,i)}},end:function(t,e,i){for(var s=0;s<t.length;s++){var n=t[s];if(this.touchA&&this.touchA.id===n.id)this.touchA=null;else{if(!this.touchB||this.touchB.id!==n.id)break;this.touchB=null}}this.touchA&&this.touchB||(this.startAngle=null)},cancel:function(t,e,i){this.touchA=null,this.touchB=null,this.startAngle=null}}),"undefined"!=typeof module&&module&&(module.exports=Toucher);